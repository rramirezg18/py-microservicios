<div class="reports-root">
  <header class="reports-hero">
    <div>
      <h1>Reportes y estadisticas</h1>
      <p>Consulta informacion consolidada de equipos, jugadores y encuentros.</p>
    </div>
  </header>

  <section id="standings" class="report-card dark-surface">
    <div class="card-head">
      <h2>Tabla de posiciones</h2>
      <div class="actions">
        <button
          class="btn btn--accent"
          (click)="downloadStandingsPdf()"
          [disabled]="standingsLoading()"
        >
          Descargar PDF
        </button>
        <button
          class="btn"
          type="button"
          (click)="openStandingsDialog()"
          [disabled]="!standings().length"
        >
          Ver detalle
        </button>
      </div>
    </div>

    <p class="alert" *ngIf="standingsError()">{{ standingsError() }}</p>

    <div *ngIf="standingsLoading()" class="state">Cargando tabla...</div>
    <div *ngIf="!standingsLoading() && !standings().length" class="state">No hay datos para mostrar.</div>

    <div class="table-wrapper" *ngIf="standings().length">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Equipo</th>
            <th>PJ</th>
            <th>PG</th>
            <th>PP</th>
            <th>PF</th>
            <th>PC</th>
            <th>DIF</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of standings()">
            <td>{{ row.rank }}</td>
            <td>{{ row.team }}</td>
            <td>{{ row.played }}</td>
            <td>{{ row.wins }}</td>
            <td>{{ row.losses }}</td>
            <td>{{ row.pf }}</td>
            <td>{{ row.pa }}</td>
            <td [class.positive]="row.diff >= 0">{{ row.diff }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <section class="report-card">
    <div class="card-head">
      <h2>Resumen estadistico</h2>
      <button class="btn" (click)="downloadStatsSummaryPdf()" [disabled]="statsLoading()">
        Descargar PDF
      </button>
    </div>

    <p class="alert" *ngIf="statsError()">{{ statsError() }}</p>
    <div *ngIf="statsLoading()" class="state">Calculando resumen...</div>

    <ng-container *ngIf="!statsLoading() && statsSummary() as snapshot">
      <div class="grid-four">
        <article>
          <header>Mas victorias</header>
          <ol>
            <li *ngFor="let item of snapshot.topWins">
              <span class="pos">{{ item.rank }}.</span>
              <span class="team">{{ item.team }}</span>
              <span class="value">{{ item.wins }} PG</span>
            </li>
          </ol>
        </article>
        <article>
          <header>Mas puntos a favor</header>
          <ol>
            <li *ngFor="let item of snapshot.topPointsFor">
              <span class="pos">{{ item.rank }}.</span>
              <span class="team">{{ item.team }}</span>
              <span class="value">{{ item.pf }} PF</span>
            </li>
          </ol>
        </article>
        <article>
          <header>Menos puntos a favor</header>
          <ol>
            <li *ngFor="let item of snapshot.lowestPointsFor">
              <span class="pos">{{ item.rank }}.</span>
              <span class="team">{{ item.team }}</span>
              <span class="value">{{ item.pf }} PF</span>
            </li>
          </ol>
        </article>
        <article>
          <header>Menos derrotas</header>
          <ol>
            <li *ngFor="let item of snapshot.fewestLosses">
              <span class="pos">{{ item.rank }}.</span>
              <span class="team">{{ item.team }}</span>
              <span class="value">{{ item.losses }} PP</span>
            </li>
          </ol>
        </article>
      </div>
      <small class="updated">Generado: {{ snapshot.generatedAtUtc | date:'medium' }}</small>
    </ng-container>
  </section>

  <section class="report-card">
    <div class="card-head">
      <h2>Descargas rapidas</h2>
    </div>

    <p class="alert" *ngIf="downloadError()">{{ downloadError() }}</p>

    <div class="download-grid">
      <button class="btn" (click)="downloadTeamsPdf()">Equipos</button>
      <button class="btn" (click)="downloadAllPlayersPdf()">Jugadores (todos)</button>
      <button class="btn" (click)="downloadStandingsPdf()">Standings</button>
      <button class="btn" (click)="downloadStatsSummaryPdf()">Resumen</button>
    </div>
  </section>

  <section class="report-card">
    <div class="card-head">
      <h2>Jugadores por equipo</h2>
      <button class="btn" (click)="downloadPlayersByTeamPdf()">Descargar PDF</button>
    </div>
    <div class="form-row">
      <label>Equipo</label>
      <select [disabled]="loadingTeams()" [(ngModel)]="teamId">
        <option [ngValue]="null" disabled>-- selecciona --</option>
        <option *ngFor="let t of teams()" [ngValue]="t.id">{{ t.name }}</option>
      </select>
      <span class="hint" *ngIf="loadingTeams()">Cargando equipos...</span>
    </div>
  </section>

  <section class="report-card">
    <div class="card-head">
      <h2>Historial de partidos</h2>
      <button class="btn" (click)="downloadMatchesHistoryPdf()">Descargar PDF</button>
    </div>
    <div class="filters">
      <label>Desde</label>
      <input type="date" [(ngModel)]="from" />
      <label>Hasta</label>
      <input type="date" [(ngModel)]="to" />
    </div>
  </section>

  <section class="report-card">
    <div class="card-head">
      <h2>Roster por partido</h2>
      <button class="btn" (click)="downloadMatchRosterPdf()">Descargar PDF</button>
    </div>
    <div class="form-row">
      <label>Match ID</label>
      <input type="number" [(ngModel)]="matchId" placeholder="Ej: 4" />
    </div>
  </section>
</div>


