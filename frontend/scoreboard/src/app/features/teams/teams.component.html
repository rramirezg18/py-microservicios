<div class="teams-page">
  <header>
    <div>
      <h1>Equipos</h1>
      <p class="subtitle">Información servida por el microservicio Java + PostgreSQL.</p>
    </div>
    <nav>
      <a routerLink="/admin" class="link">Volver al dashboard</a>
      <a routerLink="/control" class="link">Panel de control</a>
    </nav>
  </header>

  <section class="filters">
    <form (ngSubmit)="onSubmit()" class="filters-form">
      <label>
        <span>Buscar</span>
        <input type="search" name="search" [(ngModel)]="searchTerm" placeholder="Nombre, coach o ciudad" />
      </label>

      <label>
        <span>Tamaño de página</span>
        <input type="number" min="1" max="50" name="size" [(ngModel)]="pageSize" />
      </label>

      <div class="filters-actions">
        <button type="submit" [disabled]="loading()">Buscar</button>
        <button type="button" class="secondary" (click)="clearFilters()" [disabled]="loading()">Limpiar</button>
      </div>
    </form>
  </section>

  <section class="results" aria-live="polite">
    <div class="status" *ngIf="loading()">Cargando equipos...</div>
    <div class="status error" *ngIf="error() as message">{{ message }}</div>
    <div class="status" *ngIf="isEmpty()">No se encontraron equipos que coincidan con la búsqueda.</div>

    <div class="table-wrapper" *ngIf="!loading() && !error() && teams().length">
      <table>
        <thead>
          <tr>
            <th>Equipo</th>
            <th>Coach</th>
            <th>Ciudad</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let team of teams()">
            <td><strong>{{ team.name }}</strong></td>
            <td>{{ team.coach || '—' }}</td>
            <td>{{ team.city || '—' }}</td>
            <td class="actions">
              <button type="button" (click)="viewPlayers(team)" [disabled]="playersLoading()">
                Ver jugadores
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <footer class="pagination" *ngIf="totalPages() > 1">
    <button type="button" (click)="goToPrevious()" [disabled]="page <= 1 || loading()">Anterior</button>
    <span>
      Página {{ page }} de {{ totalPages() }} · {{ totalTeams() }} equipos
    </span>
    <button type="button" (click)="goToNext()" [disabled]="loading() || page >= totalPages()">
      Siguiente
    </button>
  </footer>

  <section class="drawer" *ngIf="selectedTeam() as current">
    <div class="drawer-header">
      <div>
        <h2>{{ current.name }}</h2>
        <p class="subtitle">Plantilla obtenida vía Teams Service → Players Service</p>
      </div>
      <button type="button" (click)="closeDetails()">Cerrar</button>
    </div>

    <div class="drawer-body" aria-live="polite">
      <div class="status" *ngIf="playersLoading()">Consultando jugadores...</div>
      <div class="status error" *ngIf="playersError() as message">{{ message }}</div>

      <ul *ngIf="!playersLoading() && !playersError() && teamPlayers().length" class="players-list">
        <li *ngFor="let player of teamPlayers()">
          <div>
            <strong>{{ player.name }}</strong>
            <span class="muted" *ngIf="player.position">{{ player.position }}</span>
          </div>
          <span class="badge" *ngIf="player.number !== undefined && player.number !== null">#{{ player.number }}</span>
        </li>
      </ul>

      <p class="muted" *ngIf="!playersLoading() && !playersError() && !teamPlayers().length">
        No hay jugadores asociados a este equipo en el microservicio de jugadores.
      </p>
    </div>
  </section>
</div>
